// ============================================
// KREATIVWERKSTATT - i18n (DE / EN / DA)
// ============================================

(function () {
  var translations = {
    de: {
      'nav.workshop': 'Werkstatt',
      'nav.about': 'Über uns',
      'nav.contact': 'Kontakt',
      'hero.eyebrow': 'Kreativgården Sydals',
      'hero.title': 'Offene',
      'hero.titleAccent': 'Kreativwerkstatt',
      'hero.subtitle': 'Farben mischen, Materialien entdecken, Ideen wachsen lassen.',
      'hero.description': 'In der Kreativwerkstatt entsteht Raum für Fantasie, Ruhe und eigenes Gestalten. Ohne Vorgaben, aber mit Zeit, Begleitung und vielen Möglichkeiten.',
      'hero.cta': 'Mehr erfahren',
      'details.eyebrow': 'Auf einen Blick',
      'details.title': 'Jeden Mittwoch',
      'details.when': 'Wann',
      'details.whenValue': 'Jeden Mittwoch\n14:30 – 18:00 Uhr',
      'details.where': 'Wo',
      'details.whereValue': 'Nedervej 12\n6470 Lysabild, Dänemark',
      'details.cost': 'Beitrag',
      'details.costValue': '20 € / 150 DKK',
      'details.note': 'Offene Werkstatt – ohne Anmeldung, solange Plätze frei sind.',
      'about.eyebrow': 'Was erwartet dich',
      'about.title': 'Kreatives Gestalten ohne Grenzen',
      'about.text1': 'Die Kreativwerkstatt ist ein offener Raum für Kinder und Familien. Hier kannst du mit verschiedenen Materialien experimentieren – von Farben und Papier über Ton bis hin zu Naturmaterialien.',
      'about.text2': 'Es gibt keine festen Vorgaben und keinen Leistungsdruck. Stattdessen begleiten wir dich bei deinen eigenen Ideen und Projekten. Jede Woche stehen neue Materialien und Inspirationen bereit.',
      'about.text3': 'Kreativgården Sydals ist ein Ort für freies und kreatives Lernen in Süddänemark – ein Projekt von Familien für Familien.',
      'about.highlight1': 'Verschiedene Materialien',
      'about.highlight2': 'Für Kinder & Familien',
      'about.highlight3': 'Ohne Vorgaben',
      'about.highlight4': 'Jede Woche neu',
      'share.title': 'Teilen',
      'share.heading': 'Erzähl es weiter',
      'share.facebook': 'Facebook',
      'share.telegram': 'Telegram',
      'share.email': 'E-Mail',
      'share.copy': 'Link kopieren',
      'share.copied': 'Kopiert!',
      'cta.title': 'Komm vorbei!',
      'cta.text': 'Jeden Mittwoch von 14:30 bis 18:00 Uhr. Keine Anmeldung nötig.',
      'cta.button': 'Kontakt aufnehmen',
      'footer.project': 'Ein Projekt von Kreativgården Sydals',
      'footer.contact': 'Kontakt',
      'footer.links': 'Links',
      'footer.legal': 'Rechtliches',
      'footer.privacy': 'Datenschutz',
      'footer.cookies': 'Cookie- & Speicherrichtlinie',
      'footer.imprint': 'Impressum',
      'footer.rights': 'Alle Rechte vorbehalten.',
      'footer.cvr': 'CVR',
      'map.title': 'Standort anzeigen',
      'map.text': 'Beim Laden der Karte werden Daten an Google Maps (USA) übertragen.',
      'map.button': 'Karte laden',
      'map.link': 'Oder direkt in Google Maps öffnen',
      'langNote': '',
      'heroImg.alt': 'Kreatives Kunstwerk aus der Werkstatt',
      'aboutImg.alt': 'Geometrischer Fuchs aus Holzstäbchen'
    },
    en: {
      'nav.workshop': 'Workshop',
      'nav.about': 'About',
      'nav.contact': 'Contact',
      'hero.eyebrow': 'Kreativgården Sydals',
      'hero.title': 'Open',
      'hero.titleAccent': 'Creative Workshop',
      'hero.subtitle': 'Mix colors, discover materials, let ideas grow.',
      'hero.description': 'The Creative Workshop is a space for imagination, calm, and personal creation. No rules — just time, guidance, and endless possibilities.',
      'hero.cta': 'Learn more',
      'details.eyebrow': 'At a glance',
      'details.title': 'Every Wednesday',
      'details.when': 'When',
      'details.whenValue': 'Every Wednesday\n2:30 – 6:00 PM',
      'details.where': 'Where',
      'details.whereValue': 'Nedervej 12\n6470 Lysabild, Denmark',
      'details.cost': 'Fee',
      'details.costValue': '20 € / 150 DKK',
      'details.note': 'Open workshop — no registration needed, as long as spots are available.',
      'about.eyebrow': 'What to expect',
      'about.title': 'Creative expression without limits',
      'about.text1': 'The Creative Workshop is an open space for children and families. Here you can experiment with a wide range of materials — from paints and paper to clay and natural materials.',
      'about.text2': 'There are no fixed rules and no pressure to perform. Instead, we accompany you on your own ideas and projects. Every week, new materials and inspirations are available.',
      'about.text3': 'Kreativgården Sydals is a place for free and creative learning in southern Denmark — a project by families, for families.',
      'about.highlight1': 'Various materials',
      'about.highlight2': 'For children & families',
      'about.highlight3': 'No fixed rules',
      'about.highlight4': 'New every week',
      'share.title': 'Share',
      'share.heading': 'Spread the word',
      'share.facebook': 'Facebook',
      'share.telegram': 'Telegram',
      'share.email': 'Email',
      'share.copy': 'Copy link',
      'share.copied': 'Copied!',
      'cta.title': 'Come visit!',
      'cta.text': 'Every Wednesday from 2:30 to 6:00 PM. No registration needed.',
      'cta.button': 'Get in touch',
      'footer.project': 'A project by Kreativgården Sydals',
      'footer.contact': 'Contact',
      'footer.links': 'Links',
      'footer.legal': 'Legal',
      'footer.privacy': 'Privacy Policy',
      'footer.cookies': 'Cookie & Storage Policy',
      'footer.imprint': 'Imprint',
      'footer.rights': 'All rights reserved.',
      'footer.cvr': 'CVR',
      'map.title': 'Show location',
      'map.text': 'Loading the map will transmit data to Google Maps (USA).',
      'map.button': 'Load map',
      'map.link': 'Or open directly in Google Maps',
      'langNote': '',
      'heroImg.alt': 'Creative artwork from the workshop',
      'aboutImg.alt': 'Geometric fox made from wooden sticks'
    },
    da: {
      'nav.workshop': 'Værksted',
      'nav.about': 'Om os',
      'nav.contact': 'Kontakt',
      'hero.eyebrow': 'Kreativgården Sydals',
      'hero.title': 'Åbent',
      'hero.titleAccent': 'Kreativt Værksted',
      'hero.subtitle': 'Bland farver, udforsk materialer, lad ideer vokse.',
      'hero.description': 'I det kreative værksted er der plads til fantasi, ro og egen skabelse. Uden regler — men med tid, vejledning og mange muligheder.',
      'hero.cta': 'Læs mere',
      'details.eyebrow': 'Overblik',
      'details.title': 'Hver onsdag',
      'details.when': 'Hvornår',
      'details.whenValue': 'Hver onsdag\nkl. 14:30 – 18:00',
      'details.where': 'Hvor',
      'details.whereValue': 'Nedervej 12\n6470 Lysabild, Danmark',
      'details.cost': 'Pris',
      'details.costValue': '20 € / 150 DKK',
      'details.note': 'Åbent værksted — ingen tilmelding nødvendig, så længe der er ledige pladser.',
      'about.eyebrow': 'Hvad kan du forvente',
      'about.title': 'Kreativ udfoldelse uden grænser',
      'about.text1': 'Det kreative værksted er et åbent rum for børn og familier. Her kan du eksperimentere med forskellige materialer — fra maling og papir til ler og naturmaterialer.',
      'about.text2': 'Der er ingen faste regler og intet præstationspres. I stedet ledsager vi dig i dine egne ideer og projekter. Hver uge er der nye materialer og inspiration klar.',
      'about.text3': 'Kreativgården Sydals er et sted for fri og kreativ læring i Sønderjylland — et projekt af familier, for familier.',
      'about.highlight1': 'Forskellige materialer',
      'about.highlight2': 'For børn & familier',
      'about.highlight3': 'Ingen faste regler',
      'about.highlight4': 'Nyt hver uge',
      'share.title': 'Del',
      'share.heading': 'Fortæl det videre',
      'share.facebook': 'Facebook',
      'share.telegram': 'Telegram',
      'share.email': 'E-mail',
      'share.copy': 'Kopiér link',
      'share.copied': 'Kopieret!',
      'cta.title': 'Kom forbi!',
      'cta.text': 'Hver onsdag fra kl. 14:30 til 18:00. Ingen tilmelding nødvendig.',
      'cta.button': 'Kontakt os',
      'footer.project': 'Et projekt af Kreativgården Sydals',
      'footer.contact': 'Kontakt',
      'footer.links': 'Links',
      'footer.legal': 'Juridisk',
      'footer.privacy': 'Privatlivspolitik',
      'footer.cookies': 'Cookie- & lagringspolitik',
      'footer.imprint': 'Kolofon',
      'footer.rights': 'Alle rettigheder forbeholdes.',
      'footer.cvr': 'CVR',
      'map.title': 'Vis placering',
      'map.text': 'Når kortet indlæses, overføres data til Google Maps (USA).',
      'map.button': 'Indlæs kort',
      'map.link': 'Eller åbn direkte i Google Maps',
      'langNote': 'Bemærk venligst: Vi taler desværre ikke dansk. Du er velkommen til at kontakte os på tysk eller engelsk — vi finder altid en løsning!',
      'heroImg.alt': 'Kreativt kunstværk fra værkstedet',
      'aboutImg.alt': 'Geometrisk ræv lavet af træpinde'
    }
  };

  // Detect language: saved preference > browser language > default (de)
  function detectLang() {
    var saved = localStorage.getItem('kreativwerkstatt_lang');
    if (saved && translations[saved]) return saved;
    var browserLangs = navigator.languages || [navigator.language || navigator.userLanguage || ''];
    for (var i = 0; i < browserLangs.length; i++) {
      var code = browserLangs[i].toLowerCase().split('-')[0];
      if (translations[code]) return code;
    }
    return 'de';
  }
  var currentLang = detectLang();

  function setLang(lang) {
    if (!translations[lang]) return;
    currentLang = lang;
    localStorage.setItem('kreativwerkstatt_lang', lang);
    document.documentElement.lang = lang;

    // Update all data-i18n elements
    document.querySelectorAll('[data-i18n]').forEach(function (el) {
      var key = el.getAttribute('data-i18n');
      if (translations[lang][key] !== undefined) {
        el.textContent = translations[lang][key];
      }
    });

    // Update alt texts
    var heroImg = document.getElementById('heroImg');
    var aboutImg = document.getElementById('aboutImg');
    if (heroImg) heroImg.alt = translations[lang]['heroImg.alt'];
    if (aboutImg) aboutImg.alt = translations[lang]['aboutImg.alt'];

    // Update language switcher (with aria-pressed)
    document.querySelectorAll('.kw-lang-btn').forEach(function (btn) {
      var isActive = btn.getAttribute('data-lang') === lang;
      btn.classList.toggle('active', isActive);
      btn.setAttribute('aria-pressed', isActive ? 'true' : 'false');
    });

    // Danish notice
    var notice = document.getElementById('langNotice');
    if (notice) {
      notice.style.display = (lang === 'da' && translations.da.langNote) ? '' : 'none';
    }

    // Update share links
    updateShareLinks();
  }

  function updateShareLinks() {
    var t = translations[currentLang];
    var pageUrl = window.location.href;
    var shareText = t['hero.title'] + ' ' + t['hero.titleAccent'] + ' — ' + t['hero.subtitle'];

    var fb = document.getElementById('shareFacebook');
    var tg = document.getElementById('shareTelegram');
    var em = document.getElementById('shareEmail');

    if (fb) fb.href = 'https://www.facebook.com/sharer/sharer.php?u=' + encodeURIComponent(pageUrl);
    if (tg) tg.href = 'https://t.me/share/url?url=' + encodeURIComponent(pageUrl) + '&text=' + encodeURIComponent(shareText);
    if (em) em.href = 'mailto:?subject=' + encodeURIComponent(shareText) + '&body=' + encodeURIComponent(shareText + '\n\n' + pageUrl);
  }

  // Language switcher
  document.querySelectorAll('.kw-lang-btn').forEach(function (btn) {
    btn.addEventListener('click', function () {
      setLang(this.getAttribute('data-lang'));
    });
  });

  // Burger menu
  var burger = document.getElementById('burger');
  var navLinks = document.getElementById('navLinks');
  function closeMenu() {
    if (burger && navLinks && burger.classList.contains('open')) {
      burger.classList.remove('open');
      navLinks.classList.remove('open');
      burger.setAttribute('aria-expanded', 'false');
    }
  }
  if (burger && navLinks) {
    burger.addEventListener('click', function () {
      var isOpen = !burger.classList.contains('open');
      burger.classList.toggle('open');
      navLinks.classList.toggle('open');
      burger.setAttribute('aria-expanded', isOpen ? 'true' : 'false');
      if (isOpen) {
        var firstLink = navLinks.querySelector('a');
        if (firstLink) firstLink.focus();
      }
    });
    // Close menu when clicking anchor links
    navLinks.querySelectorAll('a[href^="#"]').forEach(function (link) {
      link.addEventListener('click', closeMenu);
    });
  }

  // Google Maps consent (2-click GDPR)
  var mapConsentBtn = document.getElementById('mapConsentBtn');
  var mapEmbed = document.getElementById('mapEmbed');
  if (mapConsentBtn && mapEmbed) {
    mapConsentBtn.addEventListener('click', function () {
      var consent = document.getElementById('mapConsent');
      if (consent) consent.remove();
      var iframe = document.createElement('iframe');
      iframe.title = 'Kreativgården Sydals — Nedervej 12, 6470 Lysabild';
      iframe.src = 'https://maps.google.com/maps?q=Nedervej+12,+6470+Lysabild,+Denmark&t=&z=15&ie=UTF8&iwloc=&output=embed';
      iframe.width = '100%';
      iframe.height = '300';
      iframe.style.border = '0';
      iframe.style.borderRadius = '8px';
      iframe.allowFullscreen = true;
      iframe.loading = 'eager';
      iframe.referrerPolicy = 'no-referrer-when-downgrade';
      mapEmbed.appendChild(iframe);
    });
  }

  // Copy link
  var copyBtn = document.getElementById('copyLink');
  if (copyBtn) {
    copyBtn.addEventListener('click', function () {
      var copyText = document.getElementById('copyText');
      var t = translations[currentLang];
      navigator.clipboard.writeText(window.location.href).then(function () {
        copyText.textContent = t['share.copied'];
        setTimeout(function () { copyText.textContent = t['share.copy']; }, 2000);
      }).catch(function () {
        var input = document.createElement('input');
        input.value = window.location.href;
        document.body.appendChild(input);
        input.select();
        document.execCommand('copy');
        document.body.removeChild(input);
        copyText.textContent = t['share.copied'];
        setTimeout(function () { copyText.textContent = t['share.copy']; }, 2000);
      });
    });
  }

  // Music Player
  var playerBtn = document.getElementById('playerBtn');
  var bgMusic = document.getElementById('bgMusic');
  if (playerBtn && bgMusic) {
    var playIcon = playerBtn.querySelector('.kw-player-play');
    var pauseIcon = playerBtn.querySelector('.kw-player-pause');
    var eqIcon = playerBtn.querySelector('.kw-player-eq');
    bgMusic.volume = 0.3;

    var playerLabels = {
      de: { play: 'Hintergrundmusik abspielen', pause: 'Hintergrundmusik pausieren' },
      en: { play: 'Play background music', pause: 'Pause background music' },
      da: { play: 'Afspil baggrundsmusik', pause: 'Pause baggrundsmusik' }
    };

    function updatePlayerLabel() {
      var isPlaying = !bgMusic.paused;
      var labels = playerLabels[currentLang] || playerLabels.de;
      playerBtn.setAttribute('aria-label', isPlaying ? labels.pause : labels.play);
      playerBtn.setAttribute('aria-pressed', isPlaying ? 'true' : 'false');
      playIcon.style.display = isPlaying ? 'none' : 'block';
      pauseIcon.style.display = 'none';
      eqIcon.style.display = isPlaying ? 'block' : 'none';
    }

    playerBtn.addEventListener('click', function () {
      if (bgMusic.paused) {
        bgMusic.play().then(updatePlayerLabel).catch(function () {});
      } else {
        bgMusic.pause();
        updatePlayerLabel();
      }
    });

    // Update label when language changes
    var origSetLang = setLang;
    setLang = function (lang) {
      origSetLang(lang);
      updatePlayerLabel();
    };
  }

  // Year
  var yearEl = document.getElementById('year');
  if (yearEl) yearEl.textContent = new Date().getFullYear();

  // Init
  setLang(currentLang);
})();
